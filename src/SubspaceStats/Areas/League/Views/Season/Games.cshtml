@using SubspaceStats.Areas.League.Models
@using SubspaceStats.Areas.League.Models.Season
@using SubspaceStats.Areas.League.Models.Team
@model SeasonGamesViewModel

@{
	ViewData["Title"] = "Season Games";
	Dictionary<long, TeamModel> teamDictionary = new(Model.Teams.Count);
	foreach(var team in Model.Teams)
	{
		teamDictionary[team.Id] = team;
	}
}

<h1>Season Games</h1>

@await Html.PartialAsync("_SeasonNav")
@await Html.PartialAsync("_LeagueSeasonChooser", Model.LeagueSeasonChooser)

<div class="table-responsive">
	<table class="table table-striped table-bordered table-hover">
		<thead>
			<tr>
				<th>Game ID</th>
				<th>Round</th>
				<th>Teams</th>
				<th>Scheduled Time</th>
				<th>Game ID</th>
				<th>Status</th>
				<th colspan="2">Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var game in Model.Games)
			{

				<tr>
					<td><a asp-controller="SeasonGame" asp-action="Index" asp-route-seasonGameId="@game.SeasonGameId" class="link-underline link-underline-opacity-0 link-underline-opacity-75-hover">@game.SeasonGameId</a></td>
					<td>@game.RoundNumber</td>
					<td>
						@for (int i = 0; i < game.TeamIds.Length; i++)
						{
							if(i>0)
							{
								<text> vs </text>
							}

							long teamId = game.TeamIds[i];
							if(teamDictionary.TryGetValue(teamId, out TeamModel? team))
							{
								<a asp-controller="Team" asp-action="Index" asp-route-teamId="@teamId">@team.Name</a>
							}
							else
							{
								<a asp-controller="Team" asp-action="Index" asp-route-teamId="@teamId">@teamId</a>
							}
						}
					</td>
					<td>@game.ScheduledTimestamp</td>
					<td><a asp-area="" asp-controller="Game" asp-action="Index" asp-route-id="@game.GameId">@game.GameId</a></td>
					<td>@((GameStatus)game.GameStatusId)</td>
					<td><a asp-controller="SeasonGame" asp-action="Edit" asp-route-seasonGameId="@game.SeasonGameId">Edit</a></td>
					<td><a asp-controller="SeasonGame" asp-action="Delete" asp-route-seasonGameId="@game.SeasonGameId">Delete</a></td>
				</tr>
			}
		</tbody>
	</table>
</div>

@section Scripts {
	@await Html.PartialAsync("_LeagueSeasonChooseScript", Model.LeagueSeasonChooser)
}
